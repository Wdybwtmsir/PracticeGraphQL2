@page "/PassengerBySeat"
@using PracticeGraphQLClient2.DataAccess
@using PracticeGraphQLClient2.DataAccess.Model
@inject NavigationManager NavigationManager

<h3>🔍 Поиск пассажира по месту</h3>

<div class="row">
    <div class="col-md-3">
        <label class="form-label">ID поезда:</label>
        <input type="number" class="form-control" @bind="trainId" />
    </div>
    <div class="col-md-3">
        <label class="form-label">Номер вагона:</label>
        <input type="number" class="form-control" @bind="carriageNumber" />
    </div>
    <div class="col-md-3">
        <label class="form-label">Номер места:</label>
        <input type="number" class="form-control" @bind="seatNumber" />
    </div>
    <div class="col-md-3 d-flex align-items-end">
        <button class="btn btn-primary" @onclick="Search">Найти</button>
    </div>
</div>

@if (passenger != null)
{
    <div class="card mt-3">
        <div class="card-header bg-success text-white">
            <h5>Пассажир найден!</h5>
        </div>
        <div class="card-body">
            <p><strong>ФИО:</strong> @passenger.LastName @passenger.FirstName @passenger.SurName</p>
            <p><strong>Email:</strong> @passenger.Email</p>
            <p><strong>Телефон:</strong> @passenger.Phone</p>
            <button class="btn btn-info" @onclick="() => GoToDetails(passenger.PassengerId)">
                Подробнее
            </button>
        </div>
    </div>
}
else if (searched)
{
    <div class="alert alert-warning mt-3">
        Пассажир не найден
    </div>
}

@code {
    private int trainId;
    private int carriageNumber;
    private int seatNumber;
    private Passenger? passenger;
    private bool searched = false;

    private async Task Search()
    {
        try
        {
            searched = true;
            passenger = await Query.GetPassengerBySeat(trainId, carriageNumber, seatNumber);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Ошибка: {ex.Message}");
        }
    }

    private void GoToDetails(int id)
    {
        NavigationManager.NavigateTo("/PassengerDetails/" + id);
    }
}