@page "/CreateTicket"
@using PracticeGraphQLClient2.DataAccess
@using PracticeGraphQLClient2.DataAccess.Model
@inject NavigationManager NavigationManager

<h3>🛒 Покупка билета</h3>

<EditForm Model="@newTicket" OnValidSubmit="@HandleValidSubmit">
    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <label class="form-label">Цена:</label>
                <InputNumber class="form-control" @bind-Value="newTicket.Price" />
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label class="form-label">Статус:</label>
                <div class="form-check">
                    <InputCheckbox class="form-check-input" @bind-Value="newTicket.IsSold" />
                    <label class="form-check-label">Билет продан</label>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <label class="form-label">Дата продажи:</label>
                <InputDate class="form-control" @bind-Value="newTicket.DataProdaji" />
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label class="form-label">Продавец:</label>
                <InputText class="form-control" @bind-Value="newTicket.SellerName" />
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <label class="form-label">ID поезда:</label>
                <InputNumber class="form-control" @bind-Value="newTicket.TrainId" />
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label class="form-label">ID пассажира (необязательно):</label>
                <InputNumber class="form-control" @bind-Value="newTicket.PassengerId" />
            </div>
        </div>
    </div>

    <button type="submit" class="btn btn-primary">💾 Сохранить</button>
    <button type="button" class="btn btn-secondary" @onclick="Cancel">❌ Отмена</button>
</EditForm>

@code {
    private CreateTicketModel newTicket = new CreateTicketModel
    {
        DataProdaji = DateTime.Now,
        IsSold = true
    };

    private async Task HandleValidSubmit()
    {
        try
        {
            await Mutation.CreateTicketWithPassengerId(
                newTicket.Price,
                newTicket.IsSold,
                newTicket.DataProdaji,
                newTicket.SellerName,
                newTicket.TrainId,
                newTicket.PassengerId ?? 0
            );
            NavigationManager.NavigateTo("/TicketView");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Ошибка: {ex.Message}");
        }
    }

    private void Cancel()
    {
        NavigationManager.NavigateTo("/TicketView");
    }
}